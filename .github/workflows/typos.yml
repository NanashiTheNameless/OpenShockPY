name: Spellcheck & Fix Typos

on:
  workflow_dispatch:
  push:
    branches:
      - "main"
  release:
    types: [published]

permissions:
  contents: write
  pull-requests: write
  actions: write

jobs:
  typos:
    if: startsWith(github.ref, 'refs/heads/')
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@0c366fd6a839edf440554fa01a7085ccba70ac98
        with:
          persist-credentials: false

      - name: Install typos
        uses: crate-ci/typos@9066e9940a8a05b98fb4733c62a726f83c9e57f8
        env:
          INSTALL_DIR: ${{ runner.temp }}
        with:
          files: .
          config: typos.toml
          write_changes: true
        id: typos

      - name: Set up Git user
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Create Pull Request with fixes
        uses: NanashiTheNameless/create-pull-request@7a90ef706af1c0ae77772298e5e7435cace56f03
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: chore/typos-auto-fixes
          commit-message: "chore(typos): auto-fix spelling errors"
          title: "chore(typos): auto-fix spelling errors"
          body: |
            Automated spelling corrections using the typos action.
            - Action: crate-ci/typos
            - Config: typos.toml

            If this PR touches unintended files, adjust `typos.toml` exclusions or accepted words.
          labels: chore
          delete-branch: true
          signoff: false

      - name: Post summary
        if: always()
        run: |
          echo "Typos action completed. If changes were made, a PR was opened."
